<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:63,&quot;tests&quot;:189,&quot;passes&quot;:189,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2018-04-04T20:01:28.973Z&quot;,&quot;end&quot;:&quot;2018-04-04T20:04:13.284Z&quot;,&quot;duration&quot;:164311,&quot;testsRegistered&quot;:189,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false,&quot;passPercentClass&quot;:&quot;success&quot;,&quot;pendingPercentClass&quot;:&quot;danger&quot;},&quot;suites&quot;:{&quot;uuid&quot;:&quot;039c1bc6-1bba-4f48-8954-8b145cf4a1e1&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e780e078-e359-4d0f-bc26-1c2eda0a9152&quot;,&quot;title&quot;:&quot;ValidatorMetadataNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7cb347e6-b04e-4295-96de-7a763a925151&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;725ccb5b-64d5-47da-b901-9272eb5fcbc0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;033fa064-68b7-4d9a-951f-0d902c0f1178&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3504ab98-82b7-4c6f-b9dd-d2163cf0f2c0&quot;,&quot;title&quot;:&quot;BallotsStorageMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f549e92c-74c8-4cde-97d7-8938d24b08d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7e1a844-bcc5-46ff-82af-87b73f3a7368&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21e00f80-e40a-4427-983d-c1133e63829f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bf95504b-2a75-432d-9177-20bdb1241e34&quot;,&quot;title&quot;:&quot;EternalStorageProxyMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23b8c614-ac71-4e8c-9fb9-23cfbfd662c2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a1fca0c-22b1-43c3-be2c-fdd9302e053a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4bace8bd-0e66-4bf3-89d1-e22377e6a635&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7bbe9c44-de3c-45e5-9953-95c362b953e3&quot;,&quot;title&quot;:&quot;KeysManagerMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a491facb-49ea-4a2b-be28-a0bcefc11f81&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9fd621e1-3d9e-496d-9bf1-4b4716a0159e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed1abcba-9f64-4963-a44e-81bff6701e29&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e185918a-6b3a-4d97-acd1-648f8904f542&quot;,&quot;title&quot;:&quot;PoaNetworkConsensusMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f8b6a6f-cb0b-4d2e-802b-08d17e8d655c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;608071e4-af36-445d-be49-c6331a97bb88&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57607c3e-f28f-4101-ba03-33c9e21c3686&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;853a8247-6ed6-4342-9bc9-2e0b8ed35f24&quot;,&quot;title&quot;:&quot;ProxyStorageMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36fdaa0f-4704-463a-be02-8e26143112b7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6df6230-736f-47d0-b128-8eaac6a8f4ac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08913205-d5a4-4e2f-9a6a-0ccd048fbc66&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7bb1446b-01d4-41fc-828f-d2bf7b8f93a8&quot;,&quot;title&quot;:&quot;ValidatorMetadataMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;436245cb-3190-47f1-a60c-9cef5924a340&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;250b6ab7-4b76-4a26-875d-37d0339d921a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84311564-3a63-4361-bda1-f7c8ce40a4df&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6b28dfb8-a18e-4c8c-95ec-83bcf0ba776c&quot;,&quot;title&quot;:&quot;VotingToChangeKeysMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc667b59-2845-4fd3-b8c8-394cc3577fee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3adfc3e5-ef20-449e-8214-91fc23a9568b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95e2328e-926c-424f-b54e-64e970a08fc6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;598a81b1-ec3c-45fe-b843-bcd63888b019&quot;,&quot;title&quot;:&quot;VotingToChangeMinThresholdMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96d3b8e3-4440-424a-a8ad-0bb59f5ce797&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;780a4d97-bd5f-44fe-946a-3e04a2a4c9d5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51634d5d-3223-411e-8d94-a562848464f4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d4b9b3e5-cd8f-4a38-b18f-d7c91d95c2e0&quot;,&quot;title&quot;:&quot;VotingToChangeProxyAddressMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f16ed0a-7379-445b-b62c-97c7e8b3a5fc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;467d792f-4726-46f4-b6ae-e1335718d0b2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8db6ba44-307d-4653-95de-2f1417afeb14&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f85f41a2-f94b-4500-823d-efaa257b07c0&quot;,&quot;title&quot;:&quot;Contract: BallotsStorage [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85f76f49-c550-4f23-8c5d-a53381c345a6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28218fc6-6fa1-45cc-8291-35df68012bba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:277,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorageMock.new(poaNetworkConsensus.address);\nballotsStorageMock = await BallotsStorageMock.new(proxyStorage.address);\nkeysManager = await KeysManagerMock.new(proxyStorage.address, poaNetworkConsensus.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nawait proxyStorage.initializeAddresses(\n  keysManager.address,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorageMock.address,\n  validatorMetadataEternalStorage\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35880b96-9739-4f66-a85f-d165eeb62325&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0301efb-f9c7-4b8a-9aeb-7542134bea95&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cd797927-e79a-462d-9054-11daa4d1cb5a&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets MoC and Poa&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #constructor sets MoC and Poa&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(3).should.be.bignumber.equal(\n  await ballotsStorageMock.getBallotThreshold(1)\n);\nnew web3.BigNumber(2).should.be.bignumber.equal(\n  await ballotsStorageMock.getBallotThreshold(2)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9835f369-1030-4f03-bd5b-780f57ccd17a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9835f369-1030-4f03-bd5b-780f57ccd17a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;cd650cc0-68b5-4a4f-ad4f-aefcbd002cc7&quot;,&quot;title&quot;:&quot;#setThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeThreshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold can only be called from votingToChangeThreshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(4, 1, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(4, 1, {from: accounts[3]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbcb0249-e5a1-4e7e-8c79-466c1a9b9a39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set for Invalid threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold cannot be set for Invalid threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:138,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(5, 0, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(5, -10, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(5, -1, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(5, 3, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e5326c0-9dd9-4fc2-9897-e50ef0113d0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new value cannot be equal to 0&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold new value cannot be equal to 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:135,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(0, 1, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(0, 2, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageMock.setThreshold(4, 1, {from: accounts[3]}).should.be.fulfilled;\nawait ballotsStorageMock.setThreshold(4, 2, {from: accounts[3]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dda740c7-d968-40bd-80d6-d1f4b384444e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for Keys threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold sets new value for Keys threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(5, 1, {from: accounts[3]}).should.be.fulfilled; \nnew web3.BigNumber(5).should.be.bignumber.equal(await ballotsStorageMock.getBallotThreshold(1));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;efeb73b0-cbdc-4167-918f-7b785a1ca915&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for MetadataChange threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold sets new value for MetadataChange threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorageMock.setThreshold(6, 2, {from: accounts[3]}).should.be.fulfilled;\nnew web3.BigNumber(6).should.be.bignumber.equal(await ballotsStorageMock.getBallotThreshold(2));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c093b82-5542-471c-9af1-d1fe40ed2449&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bbcb0249-e5a1-4e7e-8c79-466c1a9b9a39&quot;,&quot;8e5326c0-9dd9-4fc2-9897-e50ef0113d0a&quot;,&quot;dda740c7-d968-40bd-80d6-d1f4b384444e&quot;,&quot;efeb73b0-cbdc-4167-918f-7b785a1ca915&quot;,&quot;0c093b82-5542-471c-9af1-d1fe40ed2449&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:480,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;fd0614fe-f7b6-4f60-b344-e7aa250fa6ea&quot;,&quot;title&quot;:&quot;#getTotalNumberOfValidators&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns total number of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getTotalNumberOfValidators returns total number of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:181,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait poaNetworkConsensus.addValidator(accounts[1], true);\nawait poaNetworkConsensus.setSystemAddress(masterOfCeremony);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators();\nnew web3.BigNumber(2).should.be.bignumber.equal(getValidators.length);\nnew web3.BigNumber(2).should.be.bignumber.equal(await ballotsStorageMock.getTotalNumberOfValidators())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8908984f-bbf0-4687-a57f-fa7ff3136d64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8908984f-bbf0-4687-a57f-fa7ff3136d64&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:181,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;360c23b2-aef6-4a5a-91b5-df94493ac0d9&quot;,&quot;title&quot;:&quot;#getProxyThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns total number of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getProxyThreshold returns total number of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:399,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorageMock.getProxyThreshold())\nawait proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait poaNetworkConsensus.addValidator(accounts[1], true);\nawait poaNetworkConsensus.addValidator(accounts[2], true);\nawait poaNetworkConsensus.addValidator(accounts[3], true);\nawait poaNetworkConsensus.addValidator(accounts[4], true);\nawait poaNetworkConsensus.addValidator(accounts[5], true);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators();\nnew web3.BigNumber(6).should.be.bignumber.equal(getValidators.length);\nnew web3.BigNumber(3).should.be.bignumber.equal(await ballotsStorageMock.getProxyThreshold())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2020e6fb-6328-41bb-8771-4de4478eb8fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2020e6fb-6328-41bb-8771-4de4478eb8fe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:399,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;50572d21-7d97-479f-b804-c07fca845ef5&quot;,&quot;title&quot;:&quot;#getVotingToChangeThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns voting to change min threshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getVotingToChangeThreshold returns voting to change min threshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingToChangeMinThreshold.should.be.equal(await ballotsStorageMock.getVotingToChangeThreshold())\nawait proxyStorage.setVotingToChangeMinThresholdMock(accounts[4]);\naccounts[4].should.be.equal(await ballotsStorageMock.getVotingToChangeThreshold())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c3d41d9-adc0-4ba4-b9e2-ee654fc29ee9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3c3d41d9-adc0-4ba4-b9e2-ee654fc29ee9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ca29329b-a8b6-43ea-ba4f-5c9daff88d9b&quot;,&quot;title&quot;:&quot;#getBallotLimit&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns limit per validator to create ballots&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getBallotLimit returns limit per validator to create ballots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:271,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let limit = await ballotsStorageMock.getBallotLimitPerValidator();\nlimit.should.be.bignumber.equal(200);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlimit = await ballotsStorageMock.getBallotLimitPerValidator();\nlimit.should.be.bignumber.equal(100);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da99cc1e-806b-4d8f-8936-65cd969e000c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;da99cc1e-806b-4d8f-8936-65cd969e000c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:271,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;00eaf619-190a-4299-a477-95c0fd91e0be&quot;,&quot;title&quot;:&quot;Contract: KeysManager [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:313,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c85292d3-9a7a-4c10-a34d-1d91d171a62b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;334b06c7-b9f6-4413-8119-3897c17df157&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:222,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  masterOfCeremony,\n  masterOfCeremony,\n  masterOfCeremony,\n  masterOfCeremony,\n  masterOfCeremony\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60a0b705-efe1-41f2-af68-d0a78b12b3e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2067ba9d-6049-4f16-be5f-ce9f610a7a8f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4620b698-3a31-4954-bcc5-d245d7a7c604&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #constructor sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony.should.be.equal(await keysManager.masterOfCeremony());\nproxyStorageMock.address.should.be.equal(await keysManager.proxyStorage());\npoaNetworkConsensusMock.address.should.be.equal(await keysManager.poaNetworkConsensus());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32a3294c-4821-4232-9f6b-fd46c899dbae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds masterOfCeremony to validators hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #constructor adds masterOfCeremony to validators hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validator = await keysManager.validatorKeys(masterOfCeremony);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b1d9917-c19a-4338-b5d7-817189162353&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;32a3294c-4821-4232-9f6b-fd46c899dbae&quot;,&quot;0b1d9917-c19a-4338-b5d7-817189162353&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:98,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e8e1d8eb-a7d0-423b-bbad-a04e00739c3d&quot;,&quot;title&quot;:&quot;#initiateKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called by master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys can only be called by master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;645d1fa0-eda5-4b1f-8312-19d0a7241039&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot allow 0x0 addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys cannot allow 0x0 addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(&#x27;0x0&#x27;).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72722ea6-6f4e-4eea-9875-2cd8d2a08f97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize already initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;   \nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75cc9d72-3aa5-40c2-8508-49f469fd4769&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key after validator created mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize already initialized key after validator created mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:157,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;   \nawait keysManager.createKeys(accounts[3],accounts[4],accounts[5], {from: accounts[2]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb2b74ec-6f10-4da1-a8b2-4d22cd7cba88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not equal to master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not equal to master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(masterOfCeremony, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87831a53-3f31-49d6-8e84-606fa598f6cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.setMaxNumberOfInitialKeys(2);\nlet maxNumberOfInitialKeys = await keysManager.maxNumberOfInitialKeys();\nmaxNumberOfInitialKeys.should.be.bignumber.equal(2);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[3], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0dd900a0-5174-496b-af2b-6d8218e5031d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:450,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let maxNumberOfInitialKeys = await keysManager.maxNumberOfInitialKeys();\nmaxNumberOfInitialKeys.should.be.bignumber.equal(12);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000013&#x27;, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd724ca6-9d2b-4fdb-82a1-878b05843544&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment initialKeyCount by 1&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should increment initialKeyCount by 1&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let initialKeysCount = await keysManager.initialKeysCount();\ninitialKeysCount.should.be.bignumber.equal(0);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\ninitialKeysCount = await keysManager.initialKeysCount();\ninitialKeysCount.should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da79fff1-b7b1-4373-9e83-8f9fbff722de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set initialKeys hash to activated status&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should set initialKeys hash to activated status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(0).should.be.bignumber.equal(await keysManager.initialKeys(accounts[1]));\nconst {logs} = await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nnew web3.BigNumber(1).should.be.bignumber.equal(await keysManager.initialKeys(accounts[1]));\nlet initialKeysCount = await keysManager.initialKeysCount();\n// event InitialKeyCreated(address indexed initialKey, uint256 time, uint256 initialKeysCount);\nlogs[0].event.should.equal(\&quot;InitialKeyCreated\&quot;);\nlogs[0].args.initialKey.should.be.equal(accounts[1]);\ninitialKeysCount.should.be.bignumber.equal(logs[0].args.initialKeysCount);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6a1ca0c-613c-4dc5-951e-146adfaa9a37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;645d1fa0-eda5-4b1f-8312-19d0a7241039&quot;,&quot;72722ea6-6f4e-4eea-9875-2cd8d2a08f97&quot;,&quot;75cc9d72-3aa5-40c2-8508-49f469fd4769&quot;,&quot;fb2b74ec-6f10-4da1-a8b2-4d22cd7cba88&quot;,&quot;87831a53-3f31-49d6-8e84-606fa598f6cc&quot;,&quot;0dd900a0-5174-496b-af2b-6d8218e5031d&quot;,&quot;dd724ca6-9d2b-4fdb-82a1-878b05843544&quot;,&quot;da79fff1-b7b1-4373-9e83-8f9fbff722de&quot;,&quot;a6a1ca0c-613c-4dc5-951e-146adfaa9a37&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1055,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b84eb019-39b0-4019-b482-afcec72764b0&quot;,&quot;title&quot;:&quot;#createKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called from initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should only be called from initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:110,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6213690c-f948-44c7-b09b-8296fe9598d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;params should not be equal to each other&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys params should not be equal to each other&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:110,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(masterOfCeremony, masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], masterOfCeremony, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b17eed1e-e3e5-4b15-b9dd-7a315c96e42c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;any of params should not be equal to initialKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys any of params should not be equal to initialKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[1], masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[1], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[1], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10d885da-8736-4aa5-8664-1f2e0434626a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign mining, voting, payout keys to relative mappings&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should assign mining, voting, payout keys to relative mappings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:144,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]}).should.be.fulfilled;\ntrue.should.be.equal(\n  await keysManager.isMiningActive(accounts[4])\n)\ntrue.should.be.equal(\n  await keysManager.isVotingActive(accounts[3])\n)\ntrue.should.be.equal(\n  await keysManager.isPayoutActive(accounts[4])\n)\n// event ValidatorInitialized(address indexed miningKey, address indexed votingKey, address indexed payoutKey);\nlogs[0].event.should.be.equal(&#x27;ValidatorInitialized&#x27;);\nlogs[0].args.miningKey.should.be.equal(accounts[4]);\nlogs[0].args.votingKey.should.be.equal(accounts[3]);\nlogs[0].args.payoutKey.should.be.equal(accounts[2]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a58267f1-b52c-477d-a0bd-697c9549129c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assigns voting &lt;-&gt; mining key relationship&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should assigns voting &lt;-&gt; mining key relationship&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]});\nconst miningKey = await keysManager.getMiningKeyByVoting(accounts[3]);\nminingKey.should.be.equal(accounts[4]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecd810d5-4488-4f9c-856c-36b454cf0aa0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds validator to poaConsensus contract&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys adds validator to poaConsensus contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:111,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst index = await poaNetworkConsensusMock.currentValidatorsLength();\n(await poaNetworkConsensusMock.pendingList(index)).should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73ce0234-0a4b-4421-afb8-1f0e726e29e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst validatorKey = await keysManager.validatorKeys(miningKey);\nvalidatorKey.should.be.deep.equal([\n  accounts[3],\n  accounts[2],\n  true,\n  true,\n  true\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7098284-0e28-46bd-8cbb-866f660d2ccf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:138,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nnew web3.BigNumber(2).should.be.bignumber.equal(await keysManager.initialKeys(accounts[1]));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86f3d7fb-7d2d-4a29-a87e-da82e2b94516&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6213690c-f948-44c7-b09b-8296fe9598d5&quot;,&quot;b17eed1e-e3e5-4b15-b9dd-7a315c96e42c&quot;,&quot;10d885da-8736-4aa5-8664-1f2e0434626a&quot;,&quot;a58267f1-b52c-477d-a0bd-697c9549129c&quot;,&quot;ecd810d5-4488-4f9c-856c-36b454cf0aa0&quot;,&quot;73ce0234-0a4b-4421-afb8-1f0e726e29e3&quot;,&quot;a7098284-0e28-46bd-8cbb-866f660d2ccf&quot;,&quot;86f3d7fb-7d2d-4a29-a87e-da82e2b94516&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:944,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5bf0474b-ce05-435b-b947-3986fef5f51a&quot;,&quot;title&quot;:&quot;#addMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called from votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should only be called from votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1],{from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait keysManager.addMiningKey(accounts[1], {from: accounts[2]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;331338b0-ed2d-4c79-8065-99b53bb307f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add more than maxLimit&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should not let add more than maxLimit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensusMock.setCurrentValidatorsLength(2001);\nawait keysManager.addMiningKey(accounts[2]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25cc4937-320e-4c8a-8d0b-cb723673fff1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[2]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0075939d-264d-4338-9a5b-e183b0c38c4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;331338b0-ed2d-4c79-8065-99b53bb307f3&quot;,&quot;25cc4937-320e-4c8a-8d0b-cb723673fff1&quot;,&quot;0075939d-264d-4338-9a5b-e183b0c38c4c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:214,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;53a40abc-97bd-446f-9efa-d3fc37bf064b&quot;,&quot;title&quot;:&quot;#addVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey should add VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:182,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addVotingKey(accounts[2],accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\ntrue.should.be.equal(await keysManager.isVotingActive(accounts[2]));\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting(accounts[2]);\nminingKey.should.be.equal(accounts[1]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec332563-52b5-447a-a545-eeaa346a1350&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[2], accounts[1]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f600f438-38c1-4481-b9c5-b5dc8133a5b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:168,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nfalse.should.be.equal(await keysManager.isVotingActive(accounts[2]));\ntrue.should.be.equal(await keysManager.isVotingActive(accounts[3]));\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd565ded-16c1-4bf3-992c-6d93d7ab751c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ec332563-52b5-447a-a545-eeaa346a1350&quot;,&quot;f600f438-38c1-4481-b9c5-b5dc8133a5b3&quot;,&quot;cd565ded-16c1-4bf3-992c-6d93d7ab751c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:489,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;fff5c7a6-267b-4bce-a819-13ced6aa3e77&quot;,&quot;title&quot;:&quot;#addPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey should add PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addPayoutKey(accounts[2],accounts[1]).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e464477e-fb95-4f21-8e1d-1b0cf0a4e275&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:165,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;330006ae-058e-4cab-86ff-8cbe379f84eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:144,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[3], accounts[1]).should.be.fulfilled;\ntrue.should.be.equal(await keysManager.isPayoutActive(accounts[1]));\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83c2a812-9bd9-4fbc-8ab8-c65e838bb962&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e464477e-fb95-4f21-8e1d-1b0cf0a4e275&quot;,&quot;330006ae-058e-4cab-86ff-8cbe379f84eb&quot;,&quot;83c2a812-9bd9-4fbc-8ab8-c65e838bb962&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:432,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ce057761-57ec-4df5-93ec-46f079b20ac5&quot;,&quot;title&quot;:&quot;#removeMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey should remove miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:212,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removeMiningKey(accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting(validator[0]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92efeb9f-df21-47c8-a567-a966e988a865&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;removes validator from poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey removes validator from poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:318,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensusMock.currentValidatorsLength();\nlet pendingList = [];\nfor(let i = 0; i &lt; currentValidatorsLength.sub(1).toNumber(); i++){\n    let pending = await poaNetworkConsensusMock.pendingList(i);\n    pendingList.push(pending);\n}\npendingList.should.not.contain(accounts[1]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(accounts[1]);\nconst expected = currentValidatorsLength.sub(1);\nconst actual = await poaNetworkConsensusMock.currentValidatorsLength();\nexpected.should.be.bignumber.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a1f683e-c04c-4cdd-a32e-b1214c1f0213&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should still enforce removal of votingKey to 0x0 even if voting key didnot exist&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey should still enforce removal of votingKey to 0x0 even if voting key didnot exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:174,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removeMiningKey(accounts[1]).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nconst miningKey = await keysManager.getMiningKeyByVoting(validator[0]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb21a8e6-d177-41f1-8839-452af4353c26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;92efeb9f-df21-47c8-a567-a966e988a865&quot;,&quot;8a1f683e-c04c-4cdd-a32e-b1214c1f0213&quot;,&quot;bb21a8e6-d177-41f1-8839-452af4353c26&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:704,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;78976d6d-1d05-48d2-ab21-abd350999cfe&quot;,&quot;title&quot;:&quot;#removeVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove votingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeVotingKey should remove votingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:215,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait keysManager.removeVotingKey(mining, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(mining).should.be.fulfilled;\nawait keysManager.addVotingKey(voting, mining).should.be.fulfilled;\nawait keysManager.addPayoutKey(payout, mining).should.be.fulfilled;\nconst {logs} = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(mining);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  payout,\n  true,\n  false,\n  true]\n)\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(voting);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting(accounts[1]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c82788e-2939-4793-a707-e4d0fc20562f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5c82788e-2939-4793-a707-e4d0fc20562f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:215,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;440ba1ae-294e-4774-95f1-9eded5b2f62e&quot;,&quot;title&quot;:&quot;#removePayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove payoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removePayoutKey should remove payoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:187,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removePayoutKey(accounts[1], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst {logs} = await keysManager.removePayoutKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;041c6bf7-257c-4595-af10-e0278eed09d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;041c6bf7-257c-4595-af10-e0278eed09d1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:187,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b9a0a17e-b1f7-4fa7-b2d1-e408d0c91586&quot;,&quot;title&quot;:&quot;#swapMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapMiningKey should swap mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:212,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapMiningKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.swapMiningKey(accounts[2], accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst validatorNew = await keysManager.validatorKeys(accounts[2]);\nvalidatorNew.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7db4957a-3b0a-4703-80b4-c2127d21e5ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should keep voting and payout keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapMiningKey should keep voting and payout keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:350,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const oldMining = accounts[1];\nconst voting = accounts[2];\nconst payout = accounts[3];\nconst newMining = accounts[4];\nawait keysManager.addMiningKey(oldMining).should.be.fulfilled;\nawait keysManager.addVotingKey(voting, oldMining).should.be.fulfilled;\nawait keysManager.addPayoutKey(payout, oldMining).should.be.fulfilled;\nconst {logs} = await keysManager.swapMiningKey(newMining, oldMining).should.be.fulfilled;\nconst mining = await keysManager.getMiningKeyByVoting(voting);\nconst validator = await keysManager.validatorKeys(oldMining);\nconst miningCheck = await keysManager.getMiningKeyByVoting(voting);\nminingCheck.should.be.equal(newMining);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst validatorNew = await keysManager.validatorKeys(newMining);\nvalidatorNew.should.be.deep.equal(\n  [ voting,\n  payout,\n  true,\n  true,\n  true]\n)\noldMining.should.be.equal(await keysManager.getMiningKeyHistory(newMining));\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(oldMining);\nvalidators.should.contain(newMining);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44d959ee-4e05-4d86-8fe9-82cbff421385&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7db4957a-3b0a-4703-80b4-c2127d21e5ea&quot;,&quot;44d959ee-4e05-4d86-8fe9-82cbff421385&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:562,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;df72ec27-9500-462c-a514-8358579d360e&quot;,&quot;title&quot;:&quot;#swapVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapVotingKey should swap voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:185,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapVotingKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.swapVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba4a3a6d-f8af-44b3-94a4-b51e74a8c8b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ba4a3a6d-f8af-44b3-94a4-b51e74a8c8b8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:185,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f3a6201f-73e6-4033-a4d4-7b1de593133d&quot;,&quot;title&quot;:&quot;#swapPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapPayoutKey should swap payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapPayoutKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nawait keysManager.swapPayoutKey(accounts[3], accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6da96d75-00d3-465d-a8e2-21aa0ee02f8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6da96d75-00d3-465d-a8e2-21aa0ee02f8c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:178,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2449d4ed-70f6-42b7-a857-26088517db56&quot;,&quot;title&quot;:&quot;#migrateInitialKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can copy initial keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateInitialKey can copy initial keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:199,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1]);\nlet newKeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, keysManager.address);\nkeysManager.address.should.be.equal(\n  await newKeysManager.previousKeysManager()\n)\nlet initialKeys = await newKeysManager.initialKeysCount();\ninitialKeys.should.be.bignumber.equal(1);\nlet {logs} = await newKeysManager.migrateInitialKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.name.should.be.equal(\&quot;initialKey\&quot;);\nnew web3.BigNumber(1).should.be.bignumber.equal(\n  await newKeysManager.initialKeys(accounts[1])\n)\nawait newKeysManager.migrateInitialKey(accounts[2]).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(0).should.be.bignumber.equal(\n  await newKeysManager.initialKeys(accounts[2])\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2124fdf4-bd5a-4731-9cc7-138181d1b449&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;copies validator keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateInitialKey copies validator keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:592,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// let masterOfCeremony = accounts[0];\nlet miningKey = accounts[2];\nlet votingKey = accounts[3];\nlet payoutKey = accounts[4];\nlet mining2 = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait keysManager.addMiningKey(mining2, {from: accounts[2]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, votingKey, payoutKey, {from: accounts[1]}).should.be.fulfilled;\nconst validatorKeyFromOld = await keysManager.validatorKeys(miningKey);\nvalidatorKeyFromOld.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n])\nlet newKeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, keysManager.address);\n// mining #1\nlet {logs} = await newKeysManager.migrateMiningKey(miningKey);\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(miningKey);\nlogs[0].args.name.should.be.equal(\&quot;miningKey\&quot;);\nlet initialKeys = await newKeysManager.initialKeysCount();\ninitialKeys.should.be.bignumber.equal(1);\nconst validatorKey = await newKeysManager.validatorKeys(miningKey);\nvalidatorKey.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n])\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone(miningKey)\n)\nminingKey.should.be.equal(\n  await newKeysManager.getMiningKeyByVoting(votingKey)\n);\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive(miningKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isVotingActive(votingKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isPayoutActive(miningKey)\n)\n// mining#2\nawait newKeysManager.migrateMiningKey(mining2);\nconst validatorKey2 = await newKeysManager.validatorKeys(mining2);\nvalidatorKey2.should.be.deep.equal([\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  true,\n  false,\n  false\n])\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive(mining2)\n)\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone(mining2)\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddf786bb-4e9a-45a9-bfaf-446a38ce3a7b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws when trying to copy invalid mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateInitialKey throws when trying to copy invalid mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:96,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newKeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, keysManager.address);\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone(masterOfCeremony)\n);\nawait newKeysManager.migrateMiningKey(masterOfCeremony).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31ce1622-d75a-494d-948f-c72e0ef81886&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2124fdf4-bd5a-4731-9cc7-138181d1b449&quot;,&quot;ddf786bb-4e9a-45a9-bfaf-446a38ce3a7b&quot;,&quot;31ce1622-d75a-494d-948f-c72e0ef81886&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:887,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2ef03e8c-caf7-4c43-9d9c-ed03228b2617&quot;,&quot;title&quot;:&quot;Contract: ValidatorMetadata [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:994,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5343612-e0cd-43e7-8875-f37f02582a9e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79d3f9b9-9215-44e0-8762-10af9c0ff417&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:689,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n   proxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\n   keysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\n   ballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\n   await poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n   metadata = await ValidatorMetadata.new();\n   metadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, metadata.address);\n   \n   await proxyStorageMock.initializeAddresses(\n     keysManager.address,\n     masterOfCeremony,\n     masterOfCeremony,\n     masterOfCeremony,\n     ballotsStorage.address,\n     metadataEternalStorage.address\n   );\n   \n   metadata = await ValidatorMetadata.at(metadataEternalStorage.address);\n   \n   await keysManager.addMiningKey(miningKey).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey, miningKey).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey2).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey2, miningKey2).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey3).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey3, miningKey3).should.be.fulfilled;\n   await metadata.setTime(55555);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50e3948a-a63e-4bd9-aa81-dc0fae304593&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;669aded0-892f-4288-a133-f0b6bd9381a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;73293c3a-149f-4acf-bb26-96f390c238dd&quot;,&quot;title&quot;:&quot;#createMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddd1308b-d545-4b45-b92f-8397cc650669&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called by non-voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata should not let create metadata if called by non-voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: miningKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fbaa192a-b848-461d-944c-feaafd7ee74b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called second time&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata should not let create metadata if called second time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c3c7614-4639-45c3-83ec-ce2a739b339e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ddd1308b-d545-4b45-b92f-8397cc650669&quot;,&quot;fbaa192a-b848-461d-944c-feaafd7ee74b&quot;,&quot;8c3c7614-4639-45c3-83ec-ce2a739b339e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:296,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;68beaeb2-913a-47fa-8bd3-5e64cc79d208&quot;,&quot;title&quot;:&quot;#getMiningByVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #getMiningByVotingKey happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let actual = await metadata.getMiningByVotingKey(votingKey);\nminingKey.should.be.equal(actual);\nactual = await metadata.getMiningByVotingKey(accounts[4]);\n&#x27;0x0000000000000000000000000000000000000000&#x27;.should.be.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05a5287f-8a39-4a49-9f27-dd19162fc10c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;05a5287f-8a39-4a49-9f27-dd19162fc10c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:87,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2e851a9d-0718-4d63-986f-01cb1196f495&quot;,&quot;title&quot;:&quot;#changeRequest&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af8a7511-2bbb-4330-812a-d3296e9e2960&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6126d99-6a7e-4ba4-84c5-99687dc869dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let call if there is no metadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest should not let call if there is no metadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.changeRequest(...newMetadata, {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a92a1c79-be15-4cf4-a08a-258ab3012100&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;resets confirmations when changeRequest recreated&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest resets confirmations when changeRequest recreated&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:402,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nlet confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(2);\nconst {logs} = await metadata.changeRequest(...anotherData, {from: votingKey}).should.be.fulfilled;\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(0);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea35414d-882b-4bbb-96d9-a7d3a78732e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f6126d99-6a7e-4ba4-84c5-99687dc869dc&quot;,&quot;a92a1c79-be15-4cf4-a08a-258ab3012100&quot;,&quot;ea35414d-882b-4bbb-96d9-a7d3a78732e7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:572,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;bf7a5612-8537-4805-a018-3e88b3ceff6e&quot;,&quot;title&quot;:&quot;#cancelPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #cancelPendingChange happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:369,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;baad0147-33d1-4e06-a753-917a037e0e68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let delete records for someone else miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #cancelPendingChange should not let delete records for someone else miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:373,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey2}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7f171ca-fc6e-4045-8086-8a47af66ed92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;baad0147-33d1-4e06-a753-917a037e0e68&quot;,&quot;c7f171ca-fc6e-4045-8086-8a47af66ed92&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:742,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;3343d8fc-7d6c-42c8-814b-b7ddf165a8a6&quot;,&quot;title&quot;:&quot;#confirmPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not let confirm your own changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange should not let confirm your own changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:194,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2cf0a67-f305-467f-a701-7ff3c31ea4d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should confirm changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange should confirm changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:236,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Confirmed&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);\nlogs[0].args.votingSender.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87596bee-68c0-4c82-b145-f998e4838ca6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent from double voting&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange prevent from double voting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:261,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;574245da-4de8-4097-8f49-ef193d817b29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d2cf0a67-f305-467f-a701-7ff3c31ea4d2&quot;,&quot;87596bee-68c0-4c82-b145-f998e4838ca6&quot;,&quot;574245da-4de8-4097-8f49-ef193d817b29&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:691,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f29bf274-f9dd-4a5b-b8c1-a4699fc1bbe6&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:512,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nconst {logs} = await metadata.finalize(miningKey, {from: votingKey});\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nlogs[0].event.should.be.equal(&#x27;FinalizedChange&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87ef73bf-ed3b-4109-9dbf-790e56a9a53b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;87ef73bf-ed3b-4109-9dbf-790e56a9a53b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:512,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;7790553c-1606-4ddc-8f2a-1c587e5d2d47&quot;,&quot;title&quot;:&quot;#getMinThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns default value&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #getMinThreshold returns default value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getMinThreshold()).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2d312b4-c565-4c58-acfa-ae3a0b542736&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c2d312b4-c565-4c58-acfa-ae3a0b542736&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;67c13069-1997-49f9-9ccc-aecae9a4a395&quot;,&quot;title&quot;:&quot;#setProxyAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can request a new proxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #setProxyAddress can request a new proxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:330,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(proxyStorageMock.address);\nconst {logs} = await metadata.setProxyAddress(newProxy, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingProxyStorage()).should.be.equal(newProxy);\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(1);\nlogs[0].event.should.be.equal(\&quot;RequestForNewProxy\&quot;);\nlogs[0].args.newProxyAddress.should.be.equal(newProxy);\nawait metadata.confirmNewProxyAddress(newProxy, {from :votingKey2}).should.be.fulfilled;\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(2);\nlet final = await metadata.confirmNewProxyAddress(newProxy, {from: votingKey3}).should.be.fulfilled;\nfinal.logs[0].event.should.be.equal(\&quot;ChangeProxyStorage\&quot;);\nfinal.logs[0].args.newProxyAddress.should.be.equal(newProxy);\n\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(newProxy);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96e3c1b7-8d58-4787-9fe2-89f0f25d4252&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;96e3c1b7-8d58-4787-9fe2-89f0f25d4252&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:330,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;d82d79dd-7c46-4d6c-8b91-fe298ea95e8e&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;metadata = await ValidatorMetadata.new();\nmetadataEternalStorage = await EternalStorageProxy.new(proxyStorageStubAddress, metadata.address);\nmetadata = await ValidatorMetadata.at(metadataEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62708aa7-1942-4892-a0dc-6643fd86e873&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may be called only by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo may be called only by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad0df0c7-e691-47a8-bfb8-a2641b018868&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nlet oldImplementation = await metadata.implementation();\nlet newImplementation = metadataNew.address;\n(await metadataEternalStorage.implementation()).should.be.equal(oldImplementation);\nawait metadataEternalStorage.upgradeTo(newImplementation, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.implementation()).should.be.equal(newImplementation);\n(await metadataEternalStorage.implementation()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8d16131-32da-43fd-b08f-45bc23701551&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nlet oldVersion = await metadata.version();\nlet newVersion = oldVersion.add(1);\n(await metadataEternalStorage.version()).should.be.bignumber.equal(oldVersion);\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.version()).should.be.bignumber.equal(newVersion);\n(await metadataEternalStorage.version()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b084e96-d309-4d4c-b3b8-d941809a3277&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.initialized()).should.be.equal(false);\nawait metadataNew.initialize();\n(await metadataNew.initialized()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88daab4d-6541-4b68-83c2-2f0f174d1668&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.proxyStorage()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b50832c7-f782-4c1f-a31f-ac0c7139e446&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:284,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(55555);\nawait metadataEternalStorage.setProxyStorage(proxyStorageMock.address);\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadataEternalStorage.setProxyStorage(proxyStorageStubAddress);\nlet metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\nconst validators = await metadataNew.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6136e54-c30a-46c5-9e70-f5ef8cd1ac26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ad0df0c7-e691-47a8-bfb8-a2641b018868&quot;,&quot;e8d16131-32da-43fd-b08f-45bc23701551&quot;,&quot;8b084e96-d309-4d4c-b3b8-d941809a3277&quot;,&quot;88daab4d-6541-4b68-83c2-2f0f174d1668&quot;,&quot;b50832c7-f782-4c1f-a31f-ac0c7139e446&quot;,&quot;c6136e54-c30a-46c5-9e70-f5ef8cd1ac26&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:841,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2055594e-ea28-4484-8d60-f7bf4b31356d&quot;,&quot;title&quot;:&quot;Contract: ValidatorMetadata upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1116,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48e45c55-d56b-450e-a724-b0e39ec4995d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f07a1cd-eaff-4054-aaea-da7b16b7afee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:779,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n   proxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\n   keysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\n   ballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\n   await poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n   metadata = await ValidatorMetadata.new();\n   metadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, metadata.address);\n   await proxyStorageMock.initializeAddresses(\n     keysManager.address,\n     masterOfCeremony,\n     masterOfCeremony,\n     masterOfCeremony,\n     ballotsStorage.address,\n     metadataEternalStorage.address\n   );\n   //metadata = await ValidatorMetadata.at(metadataEternalStorage.address);\n   let metadataNew = await ValidatorMetadataNew.new();\n   await metadataEternalStorage.setProxyStorage(accounts[6]);\n   await metadataEternalStorage.upgradeTo(metadataNew.address, {from: accounts[6]});\n   await metadataEternalStorage.setProxyStorage(proxyStorageMock.address);\n   metadata = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n   await keysManager.addMiningKey(miningKey).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey, miningKey).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey2).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey2, miningKey2).should.be.fulfilled;\n   await keysManager.addMiningKey(miningKey3).should.be.fulfilled;\n   await keysManager.addVotingKey(votingKey3, miningKey3).should.be.fulfilled;\n   await metadata.setTime(55555);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a808d79-ea11-4dd0-87f9-5deb8147d984&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d71536d-d7e2-4258-bbaa-0a7613c3e952&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;071071c7-756d-4414-9055-629c5a8fabd4&quot;,&quot;title&quot;:&quot;#createMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;132d9d77-ff67-466c-9d58-b7000d11b320&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called by non-voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata should not let create metadata if called by non-voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: miningKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69a77873-e898-4ab8-af23-0ceb3d31f7c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called second time&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata should not let create metadata if called second time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:109,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a856bd0-9f66-49f0-a3ce-8790d96a2048&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;132d9d77-ff67-466c-9d58-b7000d11b320&quot;,&quot;69a77873-e898-4ab8-af23-0ceb3d31f7c5&quot;,&quot;2a856bd0-9f66-49f0-a3ce-8790d96a2048&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:277,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;665a78bd-ba59-44dc-a1cc-f681dca09ca9&quot;,&quot;title&quot;:&quot;#getMiningByVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #getMiningByVotingKey happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let actual = await metadata.getMiningByVotingKey(votingKey);\nminingKey.should.be.equal(actual);\nactual = await metadata.getMiningByVotingKey(accounts[4]);\n&#x27;0x0000000000000000000000000000000000000000&#x27;.should.be.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7de658a6-f0dc-456c-b337-9a9c4abb9ec4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7de658a6-f0dc-456c-b337-9a9c4abb9ec4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5f26aa70-fb44-41db-899b-66d381d04ae4&quot;,&quot;title&quot;:&quot;#changeRequest&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3230f96f-b947-4b8d-8181-9369243a1a29&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\npendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cbc4019d-ad6c-47a6-98ed-899191de4abd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let call if there is no metadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest should not let call if there is no metadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.changeRequest(...newMetadata, {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;335c4311-934e-47d7-af61-5de7e99de897&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;resets confirmations when changeRequest recreated&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest resets confirmations when changeRequest recreated&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:412,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nlet confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(2);\nconst {logs} = await metadata.changeRequest(...anotherData, {from: votingKey}).should.be.fulfilled;\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(0);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nconfirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f72c7f96-c0ba-4232-9359-fd0da7299e92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cbc4019d-ad6c-47a6-98ed-899191de4abd&quot;,&quot;335c4311-934e-47d7-af61-5de7e99de897&quot;,&quot;f72c7f96-c0ba-4232-9359-fd0da7299e92&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:563,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;51779276-288c-4fd9-b30d-79d32e586526&quot;,&quot;title&quot;:&quot;#cancelPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #cancelPendingChange happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:384,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91318b75-d7cd-4c82-b953-43fb0a4ceeef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let delete records for someone else miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #cancelPendingChange should not let delete records for someone else miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:454,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey2}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;067a666b-1907-477f-a8b8-f4f1e59490a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;91318b75-d7cd-4c82-b953-43fb0a4ceeef&quot;,&quot;067a666b-1907-477f-a8b8-f4f1e59490a6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:838,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;cfd10b32-e9b3-40cb-ac59-73eb7697214a&quot;,&quot;title&quot;:&quot;#confirmPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not let confirm your own changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange should not let confirm your own changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:212,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;784e8b78-d68e-4db7-bef2-4323aff2fd11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should confirm changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange should confirm changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:249,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Confirmed&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);\nlogs[0].args.votingSender.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64aab87d-1fa3-44ba-9e49-941e8ba4ed2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent from double voting&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange prevent from double voting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:280,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations(miningKey);\nconfirmations[0].should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3930b73-7ebc-4c55-aba4-5d22297b2562&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;784e8b78-d68e-4db7-bef2-4323aff2fd11&quot;,&quot;64aab87d-1fa3-44ba-9e49-941e8ba4ed2e&quot;,&quot;a3930b73-7ebc-4c55-aba4-5d22297b2562&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:741,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;8ff1897c-4583-4d7c-8656-19a3a9b54860&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:510,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nconst {logs} = await metadata.finalize(miningKey, {from: votingKey});\nconst validators = await metadata.validators(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst pendingChanges = await metadata.pendingChanges(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nlogs[0].event.should.be.equal(&#x27;FinalizedChange&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75ec3d8b-993d-4719-a59e-1614d37468ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;75ec3d8b-993d-4719-a59e-1614d37468ea&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:510,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2a3cc887-d95f-4504-8911-be9e16ec8f80&quot;,&quot;title&quot;:&quot;#getMinThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns default value&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #getMinThreshold returns default value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getMinThreshold()).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8c5a64e-7c2b-4af6-89be-75b9e30f69a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c8c5a64e-7c2b-4af6-89be-75b9e30f69a3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:121,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6405a872-b3dd-4c24-a4cc-458c06eb1873&quot;,&quot;title&quot;:&quot;#setProxyAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can request a new proxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #setProxyAddress can request a new proxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:282,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(proxyStorageMock.address);\nconst {logs} = await metadata.setProxyAddress(newProxy, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingProxyStorage()).should.be.equal(newProxy);\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(1);\nlogs[0].event.should.be.equal(\&quot;RequestForNewProxy\&quot;);\nlogs[0].args.newProxyAddress.should.be.equal(newProxy);\nawait metadata.confirmNewProxyAddress(newProxy, {from :votingKey2}).should.be.fulfilled;\n(await metadata.pendingProxyConfirmations(newProxy))[0].should.be.bignumber.deep.equal(2);\nlet final = await metadata.confirmNewProxyAddress(newProxy, {from: votingKey3}).should.be.fulfilled;\nfinal.logs[0].event.should.be.equal(\&quot;ChangeProxyStorage\&quot;);\nfinal.logs[0].args.newProxyAddress.should.be.equal(newProxy);\n\&quot;0x0000000000000000000000000000000000000000\&quot;.should.be.equal\n  (await metadata.pendingProxyStorage());\n(await metadata.proxyStorage()).should.be.equal(newProxy);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e45ba3ce-5722-4c4a-ab14-6b548024db3e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e45ba3ce-5722-4c4a-ab14-6b548024db3e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:282,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;10d0d9b2-e83f-4ebb-b21c-15500498653f&quot;,&quot;title&quot;:&quot;Contract: PoaNetworkConsensus [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:960,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af8b3344-0a67-4df3-91f8-c7d522b81109&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69008ea3-b179-4987-8105-f178f1554855&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:154,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensus.address);\nawait poaNetworkConsensus.setProxyStorage(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony,\n    masterOfCeremony\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec0e31f3-4af3-4a8d-9c68-8cd79ebdd9ed&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7a0482e-7b70-4e5c-9a95-9e7afe895afb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4e2bcd18-8db8-4188-bd42-488f9177f7d0&quot;,&quot;title&quot;:&quot;default values&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;finalized should be false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values finalized should be false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validators = await poaNetworkConsensus.getValidators();\nlet finalized = await poaNetworkConsensus.finalized();\nvalidators.should.be.deep.equal([\n    masterOfCeremony\n]);\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1db92c17-de9b-4ab7-bb8f-adf639fa746b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;checks systemAddress&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values checks systemAddress&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let systemAddress = await poaNetworkConsensus.systemAddress();\nsystemAddress.should.be.equal(&#x27;0xfffffffffffffffffffffffffffffffffffffffe&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;189ea86f-bf7f-4726-8971-7b04fa8cc515&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allows you to set current list of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values allows you to set current list of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:100,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorsList = [accounts[2], accounts[3], accounts[4]];\nlet poa = await PoaNetworkConsensus.new(masterOfCeremony, validatorsList);\nlet validators = await poa.getValidators();\nlet finalized = await poa.finalized();\nvalidators.should.be.deep.equal([\n    masterOfCeremony,\n    ...validatorsList\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c96ca451-5bc9-4164-bda1-fbcad016b9f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1db92c17-de9b-4ab7-bb8f-adf639fa746b&quot;,&quot;189ea86f-bf7f-4726-8971-7b04fa8cc515&quot;,&quot;c96ca451-5bc9-4164-bda1-fbcad016b9f0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:194,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;9cc8210f-7068-475b-ae75-2c472efe38be&quot;,&quot;title&quot;:&quot;#finalizeChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called by systemAddress&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should only be called by systemAddress&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.finalizeChange().should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.finalizeChange().should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;024f2591-03e2-4484-ac39-276da1ec3246&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to true&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should set finalized to true&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let finalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.false;\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nfinalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.true;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0e334ab-b9b7-4933-8c18-d5c7ac0b9944&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set currentValidators to pendingList&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should set currentValidators to pendingList&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setSystemAddress(accounts[0]);\nconst { logs } = await poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet currentValidators = [];\nlet pendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\ncurrentValidators.should.be.deep.equal(pendingList);\nlogs[0].event.should.be.equal(&#x27;ChangeFinalized&#x27;);\nlogs[0].args.newSet.should.be.deep.equal(currentValidators);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d2fdbd2-61b7-43ad-8044-039e7d55c67e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;set currentValidators to pendingList after addValidator call&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange set currentValidators to pendingList after addValidator call&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:316,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.addValidator(accounts[1], true);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet currentValidators = [];\nlet pendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\ncurrentValidators.should.be.deep.equal(pendingList);\nawait poaNetworkConsensus.addValidator(accounts[2], true);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\ncurrentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength()\nconst expected = [masterOfCeremony, accounts[1], accounts[2]];\ncurrentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\ncurrentValidators = [];\npendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\nexpected.should.be.deep.equal(pendingList);\nexpected.should.be.deep.equal(currentValidators);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a872e61-ec26-414e-9492-3a44c5112ec4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;024f2591-03e2-4484-ac39-276da1ec3246&quot;,&quot;b0e334ab-b9b7-4933-8c18-d5c7ac0b9944&quot;,&quot;1d2fdbd2-61b7-43ad-8044-039e7d55c67e&quot;,&quot;9a872e61-ec26-414e-9492-3a44c5112ec4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:520,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;fb8098a2-4db6-4f1b-9272-fe762d286eb9&quot;,&quot;title&quot;:&quot;#addValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should be called only from keys manager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should be called only from keys manager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[2]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setKeysManagerMock(accounts[5]);\nawait poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[5]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;387ab85c-1a1b-404d-98c2-d0d0cdd5c799&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to add already existing validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should not allow to add already existing validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;733bf65e-e379-423c-8dc7-30f4b81b8095&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow 0x0 addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should not allow 0x0 addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(&#x27;0x0&#x27;, true).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.addValidator(&#x27;0x0000000000000000000000000000000000000000&#x27;, true).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f06cbb2d-4255-482d-b314-045bdbda645f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorsState for new validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should set validatorsState for new validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nlet state = await poaNetworkConsensus.validatorsState(accounts[1]);\nlet pendingList = await poaNetworkConsensus.getPendingList();\nstate[0].should.be.true;\nstate[1].should.be.bignumber.equal(pendingList.length - 1)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4432b7a6-9302-4b76-abf6-057d86a9a467&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should set finalized to false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nlet finalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba64ea40-7ca6-47be-9450-0da813f99f87&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit InitiateChange with blockhash and pendingList as params&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should emit InitiateChange with blockhash and pendingList as params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nconst {logs} = await poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet currentValidators = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n    let validator = await poaNetworkConsensus.currentValidators(i);\n    currentValidators.push(validator);\n}\ncurrentValidators.push(accounts[1]);\nlogs[0].args[&#x27;newSet&#x27;].should.deep.equal(currentValidators);  \nlogs[0].event.should.be.equal(&#x27;InitiateChange&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73b54d99-73a6-45a4-8a7c-5315065d8771&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;387ab85c-1a1b-404d-98c2-d0d0cdd5c799&quot;,&quot;733bf65e-e379-423c-8dc7-30f4b81b8095&quot;,&quot;f06cbb2d-4255-482d-b314-045bdbda645f&quot;,&quot;4432b7a6-9302-4b76-abf6-057d86a9a467&quot;,&quot;ba64ea40-7ca6-47be-9450-0da813f99f87&quot;,&quot;73b54d99-73a6-45a4-8a7c-5315065d8771&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:421,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;4d26d1f1-d846-4100-a9c3-b2dacd421906&quot;,&quot;title&quot;:&quot;#removeValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should remove validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1], true).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed55120e-b450-4570-acce-2fadd4180021&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be called only from keys manager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should be called only from keys manager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:116,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.removeValidator(accounts[1],true).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b1126e34-3b03-42ec-a0b7-38fcab7342e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be allowed to remove from existing set of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should only be allowed to remove from existing set of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d665231-daba-4e59-9f5f-c8688a7502e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should decrease length of pendingList&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should decrease length of pendingList&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:319,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.addValidator(accounts[2], true).should.be.fulfilled;\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.currentValidatorsLength();\nlet pendingList = [];\nfor(let i = 0; i &lt; currentValidatorsLength; i++){\n    let pending = await poaNetworkConsensus.pendingList(i);\n    pendingList.push(pending);\n}\nconst indexOfRemovedElement = pendingList.indexOf(accounts[1]);\npendingList.splice(indexOfRemovedElement, 1);\nconst { logs } = await poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;\nlet pendingListFromContract = logs[0].args[&#x27;newSet&#x27;];\npendingListFromContract.length.should.be.equal(currentValidatorsLength.toNumber(10) - 1);\npendingList.should.be.deep.equal(pendingListFromContract);\nlogs[0].event.should.be.equal(&#x27;InitiateChange&#x27;);\nconst expected = [masterOfCeremony, accounts[2]];\nexpected.should.be.deep.equal(pendingList);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34f99cdc-3fb4-47ab-8c17-11b2d8a3a0e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change validatorsState&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should change validatorsState&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;\nconst state = await poaNetworkConsensus.validatorsState(accounts[1]);\nstate[0].should.be.false;\nstate[1].should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a9afce8-700e-4887-b677-e983ee7c6342&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should set finalized to false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nawait poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;\nconst finalized = await poaNetworkConsensus.finalized();\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d4c7c7c-4370-47ab-8b2c-8e2efb83bc23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ed55120e-b450-4570-acce-2fadd4180021&quot;,&quot;b1126e34-3b03-42ec-a0b7-38fcab7342e1&quot;,&quot;5d665231-daba-4e59-9f5f-c8688a7502e3&quot;,&quot;34f99cdc-3fb4-47ab-8c17-11b2d8a3a0e3&quot;,&quot;7a9afce8-700e-4887-b677-e983ee7c6342&quot;,&quot;6d4c7c7c-4370-47ab-8b2c-8e2efb83bc23&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:824,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;96f219db-8b3c-4539-a548-9a6d81df8663&quot;,&quot;title&quot;:&quot;#setProxyStorage&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can be called by any validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage can be called by any validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(nonValidator, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.setProxyStorage(accounts[5], {from: validator}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6adbefe3-2e3f-4da4-a261-1a581bc52c6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can only be called once&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage can only be called once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// we already call it in the beforeEach block, hence why I expect it to be rejected\nawait poaNetworkConsensus.setProxyStorage(nonValidator, {from: nonValidator}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97d02d76-6519-424d-b5cf-a799cb3cceeb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set to 0x0 address&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage cannot be set to 0x0 address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(&#x27;0x0000000000000000000000000000000000000000&#x27;, {from: validator}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f306e37-5c62-4295-bec4-e9396eb13baf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets proxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage sets proxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: validator}).should.be.fulfilled;\n(await poaNetworkConsensus.proxyStorage()).should.be.equal(newProxyStorage);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;189d179b-0c6b-4523-b3fc-9d892f8fb7d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets isMasterOfCeremonyInitialized&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage sets isMasterOfCeremonyInitialized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: validator}).should.be.fulfilled;\n(await poaNetworkConsensus.isMasterOfCeremonyInitialized()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e76448c0-280e-45de-8610-1931fc30770b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;emits MoCInitializedProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage emits MoCInitializedProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nconst {logs} = await poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: validator}).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;MoCInitializedProxyStorage&#x27;);\nlogs[0].args.proxyStorage.should.be.equal(newProxyStorage);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de1bebde-7c2d-4791-af39-e9c7823d1ccc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#getKeysManager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage #getKeysManager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newKeysManager = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait proxyStorageMock.setKeysManagerMock(newKeysManager);\n(await poaNetworkConsensus.getKeysManager()).should.be.equal(newKeysManager);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c8fcf82-c047-43b6-a94c-c254b9ebc6d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#getVotingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage #getVotingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newVotingToChangeKeys = accounts[3];\nawait poaNetworkConsensus.setIsMasterOfCeremonyInitializedMock(false);\nawait proxyStorageMock.setVotingContractMock(newVotingToChangeKeys);\n(await poaNetworkConsensus.getVotingToChangeKeys()).should.be.equal(newVotingToChangeKeys);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3421a0c1-9176-445f-9964-55b1450d50ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6adbefe3-2e3f-4da4-a261-1a581bc52c6c&quot;,&quot;97d02d76-6519-424d-b5cf-a799cb3cceeb&quot;,&quot;8f306e37-5c62-4295-bec4-e9396eb13baf&quot;,&quot;189d179b-0c6b-4523-b3fc-9d892f8fb7d5&quot;,&quot;e76448c0-280e-45de-8610-1931fc30770b&quot;,&quot;de1bebde-7c2d-4791-af39-e9c7823d1ccc&quot;,&quot;6c8fcf82-c047-43b6-a94c-c254b9ebc6d0&quot;,&quot;3421a0c1-9176-445f-9964-55b1450d50ab&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:415,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ddbf6cd1-0a86-4a3f-9593-0d98b4729a9d&quot;,&quot;title&quot;:&quot;#isValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns address of miner&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #isValidator returns address of miner&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await poaNetworkConsensus.isValidator(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.isValidator(accounts[2])).should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eae47876-7af3-46dd-9c9a-ce89e244f9fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;eae47876-7af3-46dd-9c9a-ce89e244f9fa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;32e602e8-c9cd-433a-a822-4dd2548d7348&quot;,&quot;title&quot;:&quot;Contract: ProxyStorage [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:471,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3d37393-e834-4225-89cf-003300bc02ee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e484fcf3-a925-4fb6-bcd7-83d9e0639dfa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:154,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorageMock.new(poaNetworkConsensus.address);\nvalidatorMetadata = await ValidatorMetadata.new();\nvalidatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00858de5-2e5f-4b18-93bd-177219651fb8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;242fa550-10b5-4395-9ae2-21ce349e2a5a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;da3e16ea-5f46-4c72-9211-25009f3f6003&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets MoC and Poa&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #constructor sets MoC and Poa&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus.address.should.be.equal(\n  await proxyStorage.getPoaConsensus()\n);\ntrue.should.be.equal(\n  await proxyStorage.isValidator(masterOfCeremony)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0de80fa-1c75-4195-b775-da2bff44cd9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e0de80fa-1c75-4195-b775-da2bff44cd9b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;be9ca879-cd8a-4deb-82f2-bf5c0649429d&quot;,&quot;title&quot;:&quot;#initializeAddresses&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets all addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #initializeAddresses sets all addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address,\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address,\n).should.be.fulfilled;\nkeysManager.should.be.equal(\n  await proxyStorage.getKeysManager()\n);\nvotingToChangeKeys.should.be.equal(\n  await proxyStorage.getVotingToChangeKeys()\n);\nvotingToChangeMinThreshold.should.be.equal(\n  await proxyStorage.getVotingToChangeMinThreshold()\n);\nvotingToChangeProxy.should.be.equal(\n  await proxyStorage.getVotingToChangeProxy()\n);\nballotsStorage.should.be.equal(\n  await proxyStorage.getBallotsStorage()\n);\nvalidatorMetadataEternalStorage.address.should.be.equal(\n  await proxyStorage.getValidatorMetadata()\n);\nlogs[0].event.should.be.equal(&#x27;ProxyInitialized&#x27;);\nlogs[0].args.keysManager.should.be.equal(keysManager);\nlogs[0].args.votingToChangeKeys.should.be.equal(votingToChangeKeys);\nlogs[0].args.votingToChangeMinThreshold.should.be.equal(votingToChangeMinThreshold);\nlogs[0].args.votingToChangeProxy.should.be.equal(votingToChangeProxy);\nlogs[0].args.ballotsStorage.should.be.equal(ballotsStorage);\nlogs[0].args.validatorMetadataEternalStorage.should.be.equal(validatorMetadataEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed78802b-c9bd-40d8-b84e-dc6a5234d43c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents Moc to call it more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #initializeAddresses prevents Moc to call it more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;false.should.be.equal(await proxyStorage.mocInitialized());\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address\n).should.be.fulfilled;\ntrue.should.be.equal(await proxyStorage.mocInitialized());\nawait proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;555fb125-9f32-489a-afeb-065e800c7173&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ed78802b-c9bd-40d8-b84e-dc6a5234d43c&quot;,&quot;555fb125-9f32-489a-afeb-065e800c7173&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:203,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b6208593-9e1d-4d8a-89e9-11bcbae89f33&quot;,&quot;title&quot;:&quot;#setContractAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManager,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  ballotsStorage,\n  validatorMetadataEternalStorage.address,\n  {from: masterOfCeremony}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;467dd60f-b32f-4541-81f7-1082058b95e9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeProxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress can only be called from votingToChangeProxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, accounts[2], {from: votingToChangeKeys}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorage.setContractAddress(1, accounts[2], {from: votingToChangeProxy}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d082ed95-2f88-40d5-9ff9-31aa1968d1ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set to 0x0 address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress cannot be set to 0x0 address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, &#x27;0x0000000000000000000000000000000000000000&#x27;, {from: votingToChangeProxy}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef3e00dd-c6c3-49d8-97a9-9eec633cd92c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets keysManager&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets keysManager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, accounts[2], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[2].should.be.equal(\n  await proxyStorage.getKeysManager()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f05ea120-2adb-4000-9b26-51bfbf3f1f33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(2, accounts[1], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[1].should.be.equal(\n  await proxyStorage.getVotingToChangeKeys()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fe0581a-9fd2-4001-9606-7fa98725350d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeMinThreshold&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeMinThreshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(3, accounts[2], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[2].should.be.equal(\n  await proxyStorage.getVotingToChangeMinThreshold()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5550a65f-aea9-4857-8994-da9ecd7159d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeProxy&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeProxy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(4, accounts[3], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[3].should.be.equal(\n  await proxyStorage.getVotingToChangeProxy()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb59637c-c00b-4771-8d58-9a1def1f2e24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets ballotsStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets ballotsStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(5, accounts[4], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[4].should.be.equal(\n  await proxyStorage.getBallotsStorage()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c287797-6f0d-4921-aeb6-daeac5bf37bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(6, accounts[5], {from: votingToChangeProxy}).should.be.fulfilled;\naccounts[5].should.be.equal(\n  await proxyStorage.getPoaConsensus()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f805707b-a615-4607-9956-53bee8ff65b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets validatorMetadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets validatorMetadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorMetadataNew = await ValidatorMetadata.new();\nawait proxyStorage.setContractAddress(7, validatorMetadataNew.address, {from: votingToChangeProxy}).should.be.fulfilled;\n\nlet eternalProxyAddress = await proxyStorage.getValidatorMetadata();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvalidatorMetadataNew.address.should.be.equal(\n  await eternalProxy.implementation()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;633a7a59-06df-4e35-ad5e-2a37257a0f63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets validatorMetadataEternalStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets validatorMetadataEternalStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorMetadataEternalStorageNew = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nawait proxyStorage.setContractAddress(8, validatorMetadataEternalStorageNew.address, {from: votingToChangeProxy}).should.be.fulfilled;\nvalidatorMetadataEternalStorageNew.address.should.be.equal(\n  await proxyStorage.getValidatorMetadata()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98db1879-82e7-48e1-812b-6eb6999925d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d082ed95-2f88-40d5-9ff9-31aa1968d1ca&quot;,&quot;ef3e00dd-c6c3-49d8-97a9-9eec633cd92c&quot;,&quot;f05ea120-2adb-4000-9b26-51bfbf3f1f33&quot;,&quot;4fe0581a-9fd2-4001-9606-7fa98725350d&quot;,&quot;5550a65f-aea9-4857-8994-da9ecd7159d8&quot;,&quot;cb59637c-c00b-4771-8d58-9a1def1f2e24&quot;,&quot;5c287797-6f0d-4921-aeb6-daeac5bf37bf&quot;,&quot;f805707b-a615-4607-9956-53bee8ff65b5&quot;,&quot;633a7a59-06df-4e35-ad5e-2a37257a0f63&quot;,&quot;98db1879-82e7-48e1-812b-6eb6999925d2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:467,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;17871b87-6c48-4fb2-9ff2-2772ecbac241&quot;,&quot;title&quot;:&quot;Contract: Voting to change keys [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:280,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb7de166-ed89-4610-822b-dd6f06cbf289&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87ea10a7-a9e7-4994-87e5-d75637fa38d7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:341,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nvoting = await VotingToChangeKeysMock.new(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  voting.address,\n  masterOfCeremony,\n  masterOfCeremony,\n  ballotsStorage.address,\n  masterOfCeremony\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84f594ea-bbc2-43e9-9f48-ac5e61b6ca47&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76673288-d9c5-4dcd-b9d4-aec7d6d6434a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ac014548-5d75-4a17-b468-ac18724d2eba&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #constructor happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:297,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nconst VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId();\nconst {logs} = await voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey});\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nstartTime.should.be.bignumber.equal(VOTING_START_DATE);\nendTime.should.be.bignumber.equal(VOTING_END_DATE);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;40e84966-698f-410a-ac77-2595e53e8f43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create voting with invalid duration&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #constructor should not let create voting with invalid duration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let VOTING_START_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nlet VOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = 0\nVOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = 0\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74dfb38a-8918-4669-83ae-42b2b7926aad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #constructor should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8779,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nconst VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;, {from: votingKey});\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;, {from: votingKey});\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); //add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[2], 1, \&quot;memo\&quot;, {from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;630fc6fd-8e8d-48ea-9c6d-4821b83ad28a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;40e84966-698f-410a-ac77-2595e53e8f43&quot;,&quot;74dfb38a-8918-4669-83ae-42b2b7926aad&quot;,&quot;630fc6fd-8e8d-48ea-9c6d-4821b83ad28a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9159,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;a4fbd0ed-926a-41a3-b384-28849813afc7&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:287,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nid = await voting.nextBallotId();\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[1], 1, accounts[1], 1, \&quot;memo\&quot;, {from: votingKey});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3834aea4-3c52-4f34-b03a-26da6212cee8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:102,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0909c5db-9265-4f50-95a2-2bfb867d3b7c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:111,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3a2e4b4-3d57-4df2-be98-17209f209934&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:594,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[4], accounts[2]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait keysManager.addMiningKey(accounts[3]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[5], accounts[3]).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[5]}).should.be.fulfilled;\nprogress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e0fb06a-f1db-4eb4-a942-a2bb5b6d6c64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5254fca0-ca8b-4599-a186-1686cb452e9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0dc2fc5e-d23f-467c-95cf-db2497c13a58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86d1e324-c528-43ee-8775-3ce2021cab39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:153,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69d6b640-412b-4e87-aeaa-37c4c73f4d72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:143,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd883109-3aa7-4065-98d2-39dec1310c71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:156,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17b8715a-c9b7-43f8-9a63-c5eaecc47138&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0909c5db-9265-4f50-95a2-2bfb867d3b7c&quot;,&quot;f3a2e4b4-3d57-4df2-be98-17209f209934&quot;,&quot;0e0fb06a-f1db-4eb4-a942-a2bb5b6d6c64&quot;,&quot;5254fca0-ca8b-4599-a186-1686cb452e9c&quot;,&quot;0dc2fc5e-d23f-467c-95cf-db2497c13a58&quot;,&quot;86d1e324-c528-43ee-8775-3ce2021cab39&quot;,&quot;69d6b640-412b-4e87-aeaa-37c4c73f4d72&quot;,&quot;cd883109-3aa7-4065-98d2-39dec1310c71&quot;,&quot;17b8715a-c9b7-43f8-9a63-c5eaecc47138&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1464,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b7b1c836-f282-419b-a511-9a611f86e88c&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:332,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey2, accounts[2]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[4]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey3, accounts[4]).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12771f43-fd0c-4849-b1c1-e87c81b1ca48&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path - no action since it didnot meet minimum number of totalVoters&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize happy path - no action since it didnot meet minimum number of totalVoters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:487,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Ballot to Add Payout Key for miner account[1]\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, payoutKeyToAdd, 3, accounts[1], 1, \&quot;memo\&quot;,{from: votingKey});\nlet activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 1);\n// console.log(votingId);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.finalize(votingId).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\n\nvotingState.should.be.deep.equal(\n  [\n    new web3.BigNumber(VOTING_START_DATE), //uint256 startTime;\n    new web3.BigNumber(VOTING_END_DATE), //uint256 endTime\n    payoutKeyToAdd, //address affectedKey\n    new web3.BigNumber(3), //uint256 affectedKeyType\n    accounts[1],            //address miningKey\n    new web3.BigNumber(1),  //uint256 totalVoters\n    new web3.BigNumber(-1), //int progress\n    true,                   //bool isFinalized\n    new web3.BigNumber(3),  //uint8 quorumState\n    new web3.BigNumber(1),  //uint256 ballotType\n    new web3.BigNumber(0),  //uint256 index\n    new web3.BigNumber(3),   //uint256 minThresholdOfVoters\n    miningKeyForVotingKey,   // miningKeyCreator\n    \&quot;memo\&quot;\n  ]\n)\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\nconst keysState = await keysManager.validatorKeys(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fd0f74b-2c91-4428-92ea-4fe4fd5ee004&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:592,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Ballot to Add Payout Key for miner account[1]\nawait deployAndTestBallot({\n  _affectedKey: payoutKeyToAdd,\n  _affectedKeyType: 3,\n  _miningKey: accounts[1],\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  payoutKeyToAdd,\n  true,\n  true,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2e692d5-fa2b-49fe-b146-416a89e0770d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:729,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\nlet votingKeyToAdd = accounts[5];\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ votingKeyToAdd,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09c25455-2d90-468e-af74-d36748adb26b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot create ballot for using previous mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize cannot create ballot for using previous mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1510,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n  \n})\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));\nlet validators = await poaNetworkConsensusMock.getValidators();\nawait voting.setTime(VOTING_START_DATE - 1);\nawait deployAndTestBallot({\n  _affectedKey: accounts[5],\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nawait voting.setTime(VOTING_START_DATE - 1);\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, miningKey, 1, accounts[5], 3, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a03cc01f-ce35-4eb3-be2b-d278c284f9ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:758,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.contain(miningKey);\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2fe334d-acb7-4876-a5d3-47d0cd517f65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:797,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 2,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(miningKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;706bb3fc-c4fc-4499-986b-c04bd629ae4e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:710,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet votingKeyToAdd = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKeyToAdd, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 2,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5db012b5-f466-4b87-b037-11d4dcd1d4d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:817,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addPayoutKey(affectedKey, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 2,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6a07977-4ed8-4386-9a91-33657a85dad6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:810,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addVotingKey(affectedKey, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newVotingKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newVotingKey,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ newVotingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f03328bd-c8db-4c84-8cd4-56229cbd0874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:759,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait keysManager.addPayoutKey(affectedKey, miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newPayoutKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newPayoutKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  newPayoutKey,\n  true,\n  false,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71e45900-6115-4a3c-8e38-cf0d65eb2449&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:852,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n  // uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n  // uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nconst keysState = await keysManager.validatorKeys(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst keysStateNew = await keysManager.validatorKeys(affectedKey);\nkeysStateNew.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators();\nvalidators.should.not.contain(miningKey);\nvalidators.should.contain(affectedKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator(miningKey));\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator(affectedKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a400dc06-dc21-4e58-abb6-79eddf6c4f97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize prevent double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1076,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait keysManager.addMiningKey(miningKey).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait voting.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, affectedKey, 1, miningKey, 3, \&quot;memo\&quot;,{from: votingKey});\nawait voting.createVotingForKeys(VOTING_START_DATE+2, VOTING_END_DATE+2, affectedKey, 1, miningKey, 2, \&quot;memo\&quot;,{from: votingKey});\nconst activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(3).should.be.bignumber.equal(await voting.getBallotType(votingId));\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(2).should.be.bignumber.equal(await voting.getBallotType(votingIdForSecond));\nfalse.should.be.equal(await voting.getIsFinalized(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(-1).should.be.bignumber.equal(await voting.getProgress(votingIdForSecond))\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getProgress(votingId))&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8bbb7e2c-ec1d-430e-85ee-d49bdcac17de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0fd0f74b-2c91-4428-92ea-4fe4fd5ee004&quot;,&quot;c2e692d5-fa2b-49fe-b146-416a89e0770d&quot;,&quot;09c25455-2d90-468e-af74-d36748adb26b&quot;,&quot;a03cc01f-ce35-4eb3-be2b-d278c284f9ec&quot;,&quot;a2fe334d-acb7-4876-a5d3-47d0cd517f65&quot;,&quot;706bb3fc-c4fc-4499-986b-c04bd629ae4e&quot;,&quot;5db012b5-f466-4b87-b037-11d4dcd1d4d4&quot;,&quot;e6a07977-4ed8-4386-9a91-33657a85dad6&quot;,&quot;f03328bd-c8db-4c84-8cd4-56229cbd0874&quot;,&quot;71e45900-6115-4a3c-8e38-cf0d65eb2449&quot;,&quot;a400dc06-dc21-4e58-abb6-79eddf6c4f97&quot;,&quot;8bbb7e2c-ec1d-430e-85ee-d49bdcac17de&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9897,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;40a01a8e-4ebe-447e-bb25-98af69e98534&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeMinThreshold [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1521,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a16b09f8-5017-49ad-95c5-f71b8db6fd90&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29b6c191-525d-44e8-9e08-50692db0e133&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:892,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nvoting = await Voting.new(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  masterOfCeremony,\n  voting.address,\n  masterOfCeremony,\n  ballotsStorage.address,\n  masterOfCeremony\n);\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey2, accounts[2]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[4]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey3, accounts[4]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[5]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[6]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[7]).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f61907be-3546-43c8-9b86-a4deb462ae6e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8911aa20-5489-4a4f-a694-8609098e7a1c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7bf81128-7d5f-4374-a969-272242e18c22&quot;,&quot;title&quot;:&quot;#createBallotToChangeThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5a01881-fe2e-4a93-9c1e-aa75a8404726&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey});\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nlet votingState = await voting.votingState(id);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  false,\n  new web3.BigNumber(1),\n  new web3.BigNumber(0),\n  new web3.BigNumber(3),\n  new web3.BigNumber(4),\n  miningKeyForVotingKey,\n  \&quot;memo\&quot;\n])\nstartTime.should.be.bignumber.equal(VOTING_START_DATE);\nendTime.should.be.bignumber.equal(VOTING_END_DATE);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10f68608-e32d-499e-b57b-54a8a7508383&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should be more than or equal to 3&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold proposed value should be more than or equal to 3&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 2,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71acadd4-e049-4997-b7c4-87aa8fad4193&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should not be equal to the same value&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold proposed value should not be equal to the same value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 3,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64ccbde5-35de-4586-8316-99bb260192ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallotToChangeThreshold should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8972,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\n// we have 6 validators, so 200 limit / 6 = 33.3 ~ 33\nnew web3.BigNumber(33).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 106 validators\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87f9bad0-5ee8-4a5a-9843-d4c46fed43db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;10f68608-e32d-499e-b57b-54a8a7508383&quot;,&quot;71acadd4-e049-4997-b7c4-87aa8fad4193&quot;,&quot;64ccbde5-35de-4586-8316-99bb260192ea&quot;,&quot;87f9bad0-5ee8-4a5a-9843-d4c46fed43db&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9226,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;4d9138fc-a4c4-4d2d-a095-4343975467e1&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:194,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId();\nlet validators = await poaNetworkConsensusMock.getValidators();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39f701a8-955d-4eda-b500-276a008d0154&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34f2bba8-bad7-4bba-bb84-80af4b023263&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:169,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ebb6f6e3-b111-431f-92ee-70df0d35c8b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:293,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\n// add new voter\nawait voting.vote(id, choice.reject, {from: votingKey2}).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait voting.vote(id, choice.accept, {from: votingKey3}).should.be.fulfilled;\nprogress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d4cd934-0940-4dd1-a526-f683293d0bd0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48bba4e2-fed0-4f67-9211-802724db7542&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;962028a5-5c5f-40e3-83f7-ec5da1b03bd0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1327da9a-604c-4c1d-a749-1d3cd6f144b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:158,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f62e1be-7c43-4e24-ba59-f288f954e4a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:142,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;107e3078-e163-44eb-b2fb-22418f2d1278&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:134,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f241b0e-a641-4757-9289-041bbd81b6ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;34f2bba8-bad7-4bba-bb84-80af4b023263&quot;,&quot;ebb6f6e3-b111-431f-92ee-70df0d35c8b3&quot;,&quot;3d4cd934-0940-4dd1-a526-f683293d0bd0&quot;,&quot;48bba4e2-fed0-4f67-9211-802724db7542&quot;,&quot;962028a5-5c5f-40e3-83f7-ec5da1b03bd0&quot;,&quot;1327da9a-604c-4c1d-a749-1d3cd6f144b3&quot;,&quot;0f62e1be-7c43-4e24-ba59-f288f954e4a7&quot;,&quot;107e3078-e163-44eb-b2fb-22418f2d1278&quot;,&quot;9f241b0e-a641-4757-9289-041bbd81b6ac&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1206,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6635dd8e-5fd6-4235-bed5-741e738b7f57&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;698f240a-95b8-4a4b-ae96-96ef23283041&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;doesnot change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize doesnot change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:373,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;,{from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\n\nvotingState.should.be.deep.equal(\n  [\n    new web3.BigNumber(VOTING_START_DATE), //uint256 startTime;\n    new web3.BigNumber(VOTING_END_DATE), //uint256 endTime\n    new web3.BigNumber(1),  //uint256 totalVoters\n    new web3.BigNumber(1), //int progress\n    true,                   //bool isFinalized\n    new web3.BigNumber(3),  //uint8 quorumState\n    new web3.BigNumber(0),  //uint256 index\n    new web3.BigNumber(3),   //uint256 minThresholdOfVoters\n    new web3.BigNumber(proposedValue), // uint256 proposedValue\n    miningKeyForVotingKey,  // creator\n    \&quot;memo\&quot;\n  ]\n)\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45510286-c65b-4570-9ae3-0015a984db90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change to proposedValue when quorum is reached&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize should change to proposedValue when quorum is reached&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:850,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId();\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;,{from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.reject, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\nvotingState.should.be.deep.equal(\n  [\n    new web3.BigNumber(VOTING_START_DATE), //uint256 startTime;\n    new web3.BigNumber(VOTING_END_DATE), //uint256 endTime\n    new web3.BigNumber(3),  //uint256 totalVoters\n    new web3.BigNumber(1), //int progress\n    true,                   //bool isFinalized\n    new web3.BigNumber(2),  //uint8 quorumState\n    new web3.BigNumber(0),  //uint256 index\n    new web3.BigNumber(3),   //uint256 minThresholdOfVoters\n    new web3.BigNumber(proposedValue), // uint256 proposedValue\n    miningKeyForVotingKey,  //creator\n    \&quot;memo\&quot;\n  ]\n)\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey2)\n);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey3)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold(1);\nminThresholdOfVoters.should.be.bignumber.equal(proposedValue);\nlet votingForKeys = await VotingForKeys.new(proxyStorageMock.address);\n\nlet nextId = await votingForKeys.nextBallotId();\nawait votingForKeys.createVotingForKeys(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 3, accounts[1], 1, \&quot;memo\&quot;, {from: votingKey});\nconst minThresholdVotingForKeys = await votingForKeys.getMinThresholdOfVoters(nextId);\nminThresholdVotingForKeys.should.be.bignumber.equal(proposedValue);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11760dbc-8e13-4f1f-a3ac-a32cdf2cdac0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1220,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue1 = 4;\nlet proposedValue2 = 5;\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE, VOTING_END_DATE, proposedValue1, \&quot;memo\&quot;,{from: votingKey});\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85c9\&quot;).should.be.fulfilled;\nawait keysManager.addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85d9\&quot;).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallotToChangeThreshold(VOTING_START_DATE+2, VOTING_END_DATE+2, proposedValue2, \&quot;memo\&quot;,{from: votingKey});\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nconst activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(4).should.be.bignumber.equal(await voting.getProposedValue(votingId));\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(5).should.be.bignumber.equal(await voting.getProposedValue(votingIdForSecond));\nfalse.should.be.equal(await voting.getIsFinalized(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(-1).should.be.bignumber.equal(await voting.getProgress(votingIdForSecond))\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getProgress(votingId))&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a8b40a2-8569-44f6-b19b-fa2512b0462f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;45510286-c65b-4570-9ae3-0015a984db90&quot;,&quot;11760dbc-8e13-4f1f-a3ac-a32cdf2cdac0&quot;,&quot;9a8b40a2-8569-44f6-b19b-fa2512b0462f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2443,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6c20b43c-f3fd-4027-832a-b484ee8d217a&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeProxyAddress [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1346,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a66139a6-45e5-4512-a223-2acb07ff52d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70a18d90-e160-4702-9323-38c72aab0fe6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:363,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\nproxyStorageMock = await ProxyStorageMock.new(poaNetworkConsensusMock.address);\nkeysManager = await KeysManagerMock.new(proxyStorageMock.address, poaNetworkConsensusMock.address, masterOfCeremony, \&quot;0x0000000000000000000000000000000000000000\&quot;);\nballotsStorage = await BallotsStorage.new(proxyStorageMock.address);\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nvoting = await VotingToChangeProxyAddress.new(proxyStorageMock.address);\nvalidatorMetadata = await ValidatorMetadata.new();\nvalidatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  masterOfCeremony,\n  masterOfCeremony,\n  voting.address,\n  ballotsStorage.address,\n  validatorMetadataEternalStorage.address\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;638091a5-0dc8-4db0-afea-c1628406ba8d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f2b5035-ecc4-44f6-967a-7be4386c9fad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a4280b43-f786-4d1f-8422-b6184cf51da3&quot;,&quot;title&quot;:&quot;#createBallotToChangeProxyAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03647b5c-94ac-4636-ae31-5c66da06c482&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:187,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// uint256 _startTime,\n// uint256 _endTime,\n// address _proposedValue,\n// uint8 _contractType\nconst {logs} = await voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], 1, \&quot;memo\&quot;, { from: votingKey }\n);\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nlet votingState = await voting.votingState(id);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  false,\n  new web3.BigNumber(1),\n  new web3.BigNumber(0),\n  new web3.BigNumber(1),\n  accounts[5],\n  new web3.BigNumber(1),\n  miningKeyForVotingKey,\n  \&quot;memo\&quot;        \n])\nlet activeBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId();\nnextBallotId.should.be.bignumber.equal(1);\nstartTime.should.be.bignumber.equal(VOTING_START_DATE);\nendTime.should.be.bignumber.equal(VOTING_END_DATE);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d86f037b-25ec-4190-8812-677c3427a0b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed address should not be 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress proposed address should not be 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, &#x27;0x0000000000000000000000000000000000000000&#x27;, 2, \&quot;memo\&quot;,{ from: votingKey }).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49359c56-388c-4132-ab9d-071a00ac0340&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can creates multiple ballots&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress can creates multiple ballots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:257,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { logs } = await voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], 1, \&quot;memo\&quot;,{ from: votingKey });\nconst startTime = await voting.getStartTime(id.toNumber());\nconst endTime = await voting.getEndTime(id.toNumber());\nconst keysManagerFromContract = await voting.getKeysManager();\nlet activeBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId();\nnextBallotId.should.be.bignumber.equal(1);\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE + 1, VOTING_END_DATE + 1, accounts[5], 2, \&quot;memo\&quot;,{ from: votingKey }\n);\nlet votingState = await voting.votingState(nextBallotId);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+1),\n  new web3.BigNumber(VOTING_END_DATE+1),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  false,\n  new web3.BigNumber(1),\n  new web3.BigNumber(1),\n  new web3.BigNumber(1),\n  accounts[5],\n  new web3.BigNumber(2),\n  miningKeyForVotingKey,\n  \&quot;memo\&quot;\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b67c49f4-89d9-4755-87e7-2ca9d84926ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallotToChangeProxyAddress should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8750,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 2, \&quot;memo\&quot;,{from: votingKey});\nawait voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 2, \&quot;memo\&quot;,{from: votingKey});\n// we have 1 validator, so 200 limit / 1 = 200\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator());\nawait voting.createBallotToChangeProxyAddress(VOTING_START_DATE, VOTING_END_DATE, accounts[5], 2, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7599e472-f012-4708-82c1-b90e94e3c3a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d86f037b-25ec-4190-8812-677c3427a0b0&quot;,&quot;49359c56-388c-4132-ab9d-071a00ac0340&quot;,&quot;b67c49f4-89d9-4755-87e7-2ca9d84926ef&quot;,&quot;7599e472-f012-4708-82c1-b90e94e3c3a2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9224,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;c39d9dde-64df-4293-a6b0-ff19f8ab9038&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nid = await voting.nextBallotId();\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], 1, \&quot;memo\&quot;, { from: votingKey }\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b3d2499-adfa-4a57-b834-d4bb66cf7682&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:122,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.accept, { from: votingKey }).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00764874-52cf-484c-9a0c-51fa69230c4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f67ecf9-7675-4174-a6bd-04709b9ddc36&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:571,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[3], accounts[1]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: accounts[3] }).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[4], accounts[2]).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: accounts[4] }).should.be.fulfilled;\nlet progress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait keysManager.addMiningKey(accounts[3]).should.be.fulfilled;\nawait keysManager.addVotingKey(accounts[5], accounts[3]).should.be.fulfilled;\nawait voting.vote(id, choice.accept, { from: accounts[5] }).should.be.fulfilled;\nprogress = await voting.getProgress(id);\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b32b6647-31bb-4ce0-8899-0dff02708d4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: accounts[0] }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4fccdf1-a39d-4d70-a433-2664aa0f7689&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;afb1d2b9-0e27-4716-a4fd-cfe98b7f892e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;689e69b9-2da7-4585-8878-f7f94908cffb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc04dd87-7047-4d4e-9d4a-171131673659&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca7e031e-9cd1-424a-a5e1-8105968ff2b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:144,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09a5ffee-eb13-4195-ad76-91ac26b91112&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;00764874-52cf-484c-9a0c-51fa69230c4b&quot;,&quot;3f67ecf9-7675-4174-a6bd-04709b9ddc36&quot;,&quot;b32b6647-31bb-4ce0-8899-0dff02708d4d&quot;,&quot;f4fccdf1-a39d-4d70-a433-2664aa0f7689&quot;,&quot;afb1d2b9-0e27-4716-a4fd-cfe98b7f892e&quot;,&quot;689e69b9-2da7-4585-8878-f7f94908cffb&quot;,&quot;fc04dd87-7047-4d4e-9d4a-171131673659&quot;,&quot;ca7e031e-9cd1-424a-a5e1-8105968ff2b2&quot;,&quot;09a5ffee-eb13-4195-ad76-91ac26b91112&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1443,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e3897193-474d-4c3e-b78c-2f4091a97b42&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:384,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait keysManager.addMiningKey(accounts[1]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey, accounts[1]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[6]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey2, accounts[6]).should.be.fulfilled;\nawait keysManager.addMiningKey(accounts[4]).should.be.fulfilled;\nawait keysManager.addVotingKey(votingKey3, accounts[4]).should.be.fulfilled;\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(voting.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;198cd59c-f1cf-4f0a-aaf0-af367b8419bd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;doesnot change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize doesnot change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:415,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 5;\nlet contractType = 1; //keysManager\nvotingId = await voting.nextBallotId();\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], contractType, \&quot;memo\&quot;, { from: votingKey }\n);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst { logs } = await voting.finalize(votingId, { from: votingKey }).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst votingState = await voting.votingState(votingId);\nvotingState.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(1), //totalVoters\n  new web3.BigNumber(1), //progress\n  true, //isFinalized\n  new web3.BigNumber(3), //quorumState enum QuorumStates {Invalid, InProgress, Accepted, Rejected}\n  new web3.BigNumber(0), //index\n  new web3.BigNumber(2), //minThreshold\n  accounts[5], //porposedValue\n  new web3.BigNumber(contractType),\n  miningKeyForVotingKey, //creator\n  \&quot;memo\&quot;\n])\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted(votingId, votingKey)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3ef32e0-4fd9-4010-9fdd-f0cf9372893d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getKeysManager address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getKeysManager address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:579,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 1;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getKeysManager());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c844e037-035a-41a1-bc62-46ba79dfcc56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getVotingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getVotingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:636,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 2;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getVotingToChangeKeys());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;229e5c8b-2f48-448b-918a-b60a8deb6868&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getVotingToChangeMinThreshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getVotingToChangeMinThreshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:606,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 3;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getVotingToChangeMinThreshold());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bec77b11-2886-4487-b786-13fd838202aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getVotingToChangeProxy&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getVotingToChangeProxy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:612,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 4;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getVotingToChangeProxy());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76fed06b-75bc-4c01-9aa5-3250d9e1b036&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change getBallotsStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change getBallotsStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:612,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 5;\nlet newAddress = accounts[5];\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getBallotsStorage());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5059adc6-6ab9-41ad-ac9b-3e820154ad80&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ValidatorMetadata implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change ValidatorMetadata implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:704,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 7;\nlet validatorMetadataNew = await ValidatorMetadata.new();\nlet newAddress = validatorMetadataNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getValidatorMetadata();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69a9b54e-256d-4a27-b8aa-04cfa0fe561a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ValidatorMetadata storage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change ValidatorMetadata storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:689,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 8;\nlet validatorMetadataEternalStorageNew = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nlet newAddress = validatorMetadataEternalStorageNew.address;\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageMock.getValidatorMetadata());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8cc17d72-ef0f-4170-af45-f1cbbc9ed615&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:970,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newAddress1 = accounts[4];\nlet newAddress2 = accounts[5];\nlet contractType1 = 4;\nlet contractType2 = 5;\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE, VOTING_END_DATE, newAddress1, contractType1, \&quot;memo\&quot;, { from: votingKey }\n);\nawait voting.createBallotToChangeProxyAddress(\n  VOTING_START_DATE+2, VOTING_END_DATE+2, newAddress2, contractType2, \&quot;memo\&quot;, { from: votingKey }\n);\n  \nconst activeBallotsLength = await voting.activeBallotsLength();\nvotingId = await voting.activeBallots(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\ntrue.should.be.equal(await voting.getIsFinalized(votingId));\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal(await voting.getIsFinalized(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.fulfilled;\nnew web3.BigNumber(-1).should.be.bignumber.equal(await voting.getProgress(votingIdForSecond))\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getProgress(votingId))\nlet votingState1 = await voting.votingState(votingId);\nvotingState1.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE),\n  new web3.BigNumber(VOTING_END_DATE),\n  new web3.BigNumber(3), //totalVoters\n  new web3.BigNumber(1), //progress\n  true, //isFinalized\n  new web3.BigNumber(2), //quorumState enum QuorumStates {Invalid, InProgress, Accepted, Rejected}\n  new web3.BigNumber(0), //index\n  new web3.BigNumber(2), //minThreshold\n  newAddress1, //proposedValue\n  new web3.BigNumber(contractType1),\n  miningKeyForVotingKey, //creator\n  \&quot;memo\&quot;\n])\nlet votingState2 = await voting.votingState(votingIdForSecond);\nvotingState2.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+2),\n  new web3.BigNumber(VOTING_END_DATE+2),\n  new web3.BigNumber(1), //totalVoters\n  new web3.BigNumber(-1), //progress\n  true, //isFinalized\n  new web3.BigNumber(3), //quorumState enum QuorumStates {Invalid, InProgress, Accepted, Rejected}\n  new web3.BigNumber(0), //index\n  new web3.BigNumber(2), //minThreshold\n  newAddress2, //proposedValue\n  new web3.BigNumber(contractType2),\n  miningKeyForVotingKey, //creator\n  \&quot;memo\&quot;\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed78af52-f84c-4d7b-8c0b-dc45d977c5dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d3ef32e0-4fd9-4010-9fdd-f0cf9372893d&quot;,&quot;c844e037-035a-41a1-bc62-46ba79dfcc56&quot;,&quot;229e5c8b-2f48-448b-918a-b60a8deb6868&quot;,&quot;bec77b11-2886-4487-b786-13fd838202aa&quot;,&quot;76fed06b-75bc-4c01-9aa5-3250d9e1b036&quot;,&quot;5059adc6-6ab9-41ad-ac9b-3e820154ad80&quot;,&quot;69a9b54e-256d-4a27-b8aa-04cfa0fe561a&quot;,&quot;8cc17d72-ef0f-4170-af45-f1cbbc9ed615&quot;,&quot;ed78af52-f84c-4d7b-8c0b-dc45d977c5dc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5823,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000},&quot;copyrightYear&quot;:2018}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;poa-network-consensus-contracts&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;charts&quot;:true,&quot;enableCharts&quot;:true,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;jsonFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>